(function(){if(window.__HEADER_INTERACTIONS_INITIALIZED__){return;}window.__HEADER_INTERACTIONS_INITIALIZED__=true;const headerStates=new Map();let globalListenersReady=false;function closeMenus(header,state){if(!state){return;}if(state.mainNav){state.mainNav.classList.remove("open");}if(state.userMenu){state.userMenu.classList.remove("open");}}function handleDocumentClick(event){const target=event.target instanceof Element ? event.target:null;if(!target){return;}headerStates.forEach((state,header)=>{if(!header.contains(target)){closeMenus(header,state);}});}function handleResize(){if(window.innerWidth>768){headerStates.forEach((state,header)=>{closeMenus(header,state);});}}function ensureGlobalListeners(){if(globalListenersReady){return;}document.addEventListener("click",handleDocumentClick);window.addEventListener("resize",handleResize);globalListenersReady=true;}function setupHeader(header){if(!header || headerStates.has(header)){return;}const mobileBtn=header.querySelector("#mobileMenuBtn");const mainNav=header.querySelector("#mainNav");const userBtn=header.querySelector("#userBtn");const userMenu=header.querySelector("#userMenu");const state={mainNav,userMenu};headerStates.set(header,state);if(mobileBtn && mainNav){mobileBtn.addEventListener("click",(event)=>{event.preventDefault();event.stopPropagation();const isOpen=mainNav.classList.toggle("open");if(isOpen && userMenu){userMenu.classList.remove("open");}});}if(userBtn && userMenu){userBtn.addEventListener("click",(event)=>{event.preventDefault();event.stopPropagation();const isOpen=userMenu.classList.toggle("open");if(isOpen && mainNav){mainNav.classList.remove("open");}});}}function resolveScope(root){if(root && typeof root.querySelectorAll==="function"){return root;}return document;}function publishAuthState(headers){const isAuth=Array.from(headers ||[]).some((header)=>header && header.getAttribute("data-auth")==="1");document.documentElement.setAttribute("data-user-auth",isAuth ? "1":"0");if(document.body){document.body.setAttribute("data-user-auth",isAuth ? "1":"0");}window.__TOS_IS_AUTH=isAuth;}function initHeaderInteractions(root){const scope=resolveScope(root);const headers=scope.querySelectorAll(".site-header");if(!headers.length){publishAuthState([]);return;}publishAuthState(headers);headers.forEach(setupHeader);ensureGlobalListeners();}function loadPrivacyScript(){if(window.__TOS_CONSENT_LOADER__){return;}window.__TOS_CONSENT_LOADER__=true;const script=document.createElement("script");script.src="/includi/privacy-consent.min.js?v=20251201";script.defer=true;document.head.appendChild(script);}window.initHeaderInteractions=initHeaderInteractions;loadPrivacyScript();if(document.readyState !=="loading"){initHeaderInteractions(document);}else{document.addEventListener("DOMContentLoaded",()=>initHeaderInteractions(document));}})();
﻿(function(){if(window.__TOS_CONSENT_LOADED__){return;}window.__TOS_CONSENT_LOADED__=true;const STORAGE_KEY='tosConsent';const BANNER_ID='tos-consent-banner';function isUserAuthenticated(){if(typeof window.__TOS_IS_AUTH==='boolean'){return window.__TOS_IS_AUTH;}const html=document.documentElement;const body=document.body;if(html && html.getAttribute('data-user-auth')==='1'){return true;}if(body && body.getAttribute('data-user-auth')==='1'){return true;}const header=document.querySelector('.site-header[data-auth="1"]');return !!header;}function toggleNewsletterVisibility(){const block=document.querySelector(`#${BANNER_ID}[data-newsletter-block]`);if(!block)return;const visible=isUserAuthenticated();block.style.display=visible ? '':'none';const checkbox=block.querySelector('input[data-consent="newsletter"]');if(!visible && checkbox){checkbox.checked=false;}}const Tracking=(function(){let allowed=false;const endpoint='/api/track_event.php';function sanitizeDetails(details){if(!details || typeof details !=='object')return{};const clean={};Object.keys(details).forEach((key)=>{const safeKey=String(key).replace(/[^a-zA-Z0-9_.-]/g,'').slice(0,50);if(!safeKey)return;const value=details[key];if(typeof value==='string'){clean[safeKey]=value.slice(0,200);}else if(typeof value==='number' || typeof value==='boolean'){clean[safeKey]=value;}});return clean;}function send(payload){if(!allowed)return;const body=JSON.stringify(payload);if(navigator.sendBeacon){const blob=new Blob([body],{type:'application/json'});navigator.sendBeacon(endpoint,blob);return;}fetch(endpoint,{method:'POST',headers:{'Content-Type':'application/json'},body,keepalive:true,}).catch(()=>{});}function track(eventType,details){if(!allowed)return;const payload={event_type:String(eventType || '').slice(0,64)|| 'custom',path:window.location.pathname,referrer:document.referrer || '',title:document.title || '',details:sanitizeDetails(details ||{}),ts:Date.now(),};send(payload);}function trackPageView(){track('page_view',{referrer:document.referrer || '',title:document.title || ''});}function handleClick(event){const target=event.target instanceof Element ? event.target.closest('[data-track]'):null;if(target){track('ui_interaction',{action:target.dataset.track || '',label:(target.dataset.trackLabel || target.textContent || '').trim().slice(0,80),});return;}const tabBtn=event.target instanceof Element ? event.target.closest('.tab-button'):null;if(tabBtn){track('ui_interaction',{action:'tab_click',tab:(tabBtn.dataset.tab || tabBtn.textContent || '').trim().slice(0,50),});}}function handleChange(event){const select=event.target instanceof Element ? event.target.closest('select'):null;if(select){track('select_change',{id:select.id || '',name:select.name || '',value:String(select.value || '').slice(0,80),});}}function handleSubmit(event){const form=event.target instanceof HTMLFormElement ? event.target:null;if(!form)return;track('form_submit',{id:form.id || '',action:form.getAttribute('action')|| window.location.pathname,});}document.addEventListener('click',handleClick,{passive:true});document.addEventListener('change',handleChange,{passive:true});document.addEventListener('submit',handleSubmit,true);return{enable(){if(allowed)return;allowed=true;trackPageView();},disable(){allowed=false;},track,};})();window.tosTrackEvent=function(eventType,details){Tracking.track(eventType,details);};const GoogleAnalytics=(function(){const gaId=(window.__GA_MEASUREMENT_ID || '').trim();let initialized=false;function hasId(){return gaId !=='';}function bootstrap(){if(initialized || !hasId())return;window.dataLayer=window.dataLayer ||[];window.gtag=window.gtag || function gtag(){window.dataLayer.push(arguments);};window.gtag('consent','default',{analytics_storage:'denied',ad_storage:'denied',functionality_storage:'granted',security_storage:'granted',});const script=document.createElement('script');script.async=true;script.src='https://www.googletagmanager.com/gtag/js?id='+encodeURIComponent(gaId);document.head.appendChild(script);initialized=true;}function enable(){if(!hasId())return;bootstrap();if(typeof window.gtag==='function'){window.gtag('consent','update',{analytics_storage:'granted',ad_storage:'denied',});window.gtag('js',new Date());window.gtag('config',gaId,{anonymize_ip:true,allow_ad_personalization_signals:false,transport_type:'beacon',});}}function disable(){if(typeof window.gtag==='function'){window.gtag('consent','update',{analytics_storage:'denied',ad_storage:'denied',});}}return{enable,disable,hasId,};})();const style=document.createElement('style');style.textContent=`
 #${BANNER_ID}{position:fixed;inset:0;padding:16px 12px;background:rgba(15,23,42,0.55);backdrop-filter:blur(4px);display:none;align-items:flex-end;justify-content:center;z-index:9999;font-family:"Inter","Segoe UI",system-ui,-apple-system,sans-serif;color:#0f172a;}#${BANNER_ID}.is-visible{display:flex;}#${BANNER_ID}.consent-card{width:min(760px,100%);background:#ffffff;border-radius:16px;margin:0 auto 8px;box-shadow:0 18px 48px rgba(15,23,42,0.28);border:1px solid #d7e0f0;display:flex;flex-direction:column;gap:12px;padding:18px 18px 14px;position:relative;max-height:78vh;overflow-y:auto;}#${BANNER_ID}.consent-eyebrow{text-transform:uppercase;letter-spacing:0.12em;font-size:0.78rem;font-weight:800;color:#d80000;margin:2px 0;}#${BANNER_ID}h3{margin:0 0 6px;font-size:1.28rem;color:#15293e;letter-spacing:-0.01em;}#${BANNER_ID}.consent-text{color:#475569;line-height:1.6;margin-bottom:8px;font-size:0.98rem;}#${BANNER_ID}.consent-links{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-top:8px;}#${BANNER_ID}.consent-links a{color:#15293e;font-weight:700;text-decoration:none;border-bottom:2px solid rgba(21,41,62,0.35);padding-bottom:2px;}#${BANNER_ID}.consent-links a:hover{color:#0f172a;border-color:#0f172a;}#${BANNER_ID}.consent-options{background:#f5f8fd;border:1px solid #e3eaf7;border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:10px;}#${BANNER_ID}.consent-option{display:flex;gap:10px;align-items:flex-start;background:#ffffff;border:1px solid #e5e8f0;border-radius:10px;padding:10px 12px;box-shadow:0 10px 24px rgba(15,23,42,0.06);}#${BANNER_ID}.consent-option input{margin-top:3px;width:44px;height:24px;accent-color:#15293e;cursor:pointer;}#${BANNER_ID}.consent-option-body{display:flex;flex-direction:column;gap:2px;}#${BANNER_ID}.consent-option-body strong{display:block;color:#0f172a;font-size:1rem;margin-bottom:1px;}#${BANNER_ID}.consent-option-body span{color:#4b5563;line-height:1.45;font-size:0.96rem;}#${BANNER_ID}.consent-actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;grid-column:1 /-1;margin-top:6px;}#${BANNER_ID}.consent-actions button{min-width:128px;border:none;cursor:pointer;font-weight:700;padding:11px 14px;border-radius:10px;text-align:center;letter-spacing:0.01em;transition:transform 0.15s ease,box-shadow 0.2s ease,background 0.2s ease,color 0.2s ease;}#${BANNER_ID}.consent-actions button:hover{transform:translateY(-1px);}#${BANNER_ID}.btn-primary{background:linear-gradient(135deg,#1f3d5a,#15293e);color:#fff;box-shadow:0 14px 32px rgba(21,41,62,0.25);}#${BANNER_ID}.btn-primary:hover{background:linear-gradient(135deg,#223f5e,#0f1c2e);}#${BANNER_ID}.btn-muted{background:#e9edf7;color:#1f2937;border:1px solid #d7deee;}#${BANNER_ID}.btn-ghost{background:transparent;color:#15293e;border:1px solid #cbd5e1;}#${BANNER_ID}.btn-ghost:hover{background:#f1f5f9;}@media(max-width:860px){#${BANNER_ID}{padding:12px;}#${BANNER_ID}.consent-card{padding:16px 14px 14px;gap:12px;}#${BANNER_ID}.consent-actions{justify-content:center;}#${BANNER_ID}.consent-actions button{flex:1 1 140px;}}@media(max-width:540px){#${BANNER_ID}.consent-card{border-radius:14px;}#${BANNER_ID}.consent-option{grid-template-columns:auto 1fr;align-items:center;}#${BANNER_ID}.consent-option input{margin-top:0;}}`;document.head.appendChild(style);function normalizeConsent(raw){const base={tracking:false,marketing:false,newsletter:false,ts:null};if(typeof raw==='boolean'){base.tracking=raw;return base;}if(raw && typeof raw==='object'){base.tracking=!!raw.tracking;base.marketing=!!raw.marketing;base.newsletter=!!raw.newsletter;base.ts=raw.ts || Date.now();return base;}return base;}function loadConsent(){try{const saved=localStorage.getItem(STORAGE_KEY);return saved ? normalizeConsent(JSON.parse(saved)):null;}catch(err){return null;}}function saveConsent(consent){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(consent));}catch(err){}}function syncConsentWithServer(consent){try{fetch('/api/consensi.php',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({marketing:!!consent.marketing,newsletter:!!consent.newsletter,tracking:!!consent.tracking,}),}).catch(()=>{});}catch(err){}}function hideBanner(){const banner=document.getElementById(BANNER_ID);if(banner){banner.classList.remove('is-visible');}}function showBanner(){let banner=document.getElementById(BANNER_ID);if(!banner){renderBanner();banner=document.getElementById(BANNER_ID);}if(banner){fillBanner(loadConsent()||{});toggleNewsletterVisibility();banner.classList.add('is-visible');}}function applyConsent(consent){const trackingAllowed=!!(consent && consent.tracking);if(trackingAllowed){Tracking.enable();GoogleAnalytics.enable();return;}Tracking.disable();GoogleAnalytics.disable();}function fillBanner(consent){const banner=document.getElementById(BANNER_ID);if(!banner)return;['tracking','marketing','newsletter'].forEach((key)=>{const input=banner.querySelector(`input[data-consent="${key}"]`);if(input){input.checked=!!(consent && consent[key]);}});}function collectBannerConsent(){const banner=document.getElementById(BANNER_ID);if(!banner)return{tracking:false,marketing:false,newsletter:false,ts:Date.now()};const trackingInput=banner.querySelector('input[data-consent="tracking"]');const marketingInput=banner.querySelector('input[data-consent="marketing"]');const newsletterInput=banner.querySelector('input[data-consent="newsletter"]');return{tracking:!!(trackingInput && trackingInput.checked),marketing:!!(marketingInput && marketingInput.checked),newsletter:!!(newsletterInput && newsletterInput.checked),ts:Date.now(),};}function handleSave(consent){const normalized=normalizeConsent(consent);normalized.ts=Date.now();saveConsent(normalized);applyConsent(normalized);syncConsentWithServer(normalized);hideBanner();}function renderBanner(){if(document.getElementById(BANNER_ID))return;const banner=document.createElement('div');banner.id=BANNER_ID;banner.innerHTML=`<div class="consent-card" role="dialog" aria-modal="true" aria-labelledby="consentTitle"><div class="consent-copy"><p class="consent-eyebrow">Privacy e cookie</p><h3 id="consentTitle">Gestisci le preferenze</h3><p class="consent-text">Usiamo cookie tecnici e,se acconsenti,registriamo alcune azioni anonime per migliorare il sito(senza salvare i contenuti dei form).</p><div class="consent-links"><a href="/privacy.php">Privacy</a><a href="/cookie.php">Cookie</a></div></div><div class="consent-options"><label class="consent-option"><input type="checkbox" data-consent="tracking"><div class="consent-option-body"><strong>Analytics anonimi</strong><span>Tracciamento utilizzo del sito(eventi anonimi)per analisi aggregate.</span></div></label><label class="consent-option" data-newsletter-block="1"><input type="checkbox" data-consent="newsletter"><div class="consent-option-body"><strong>Newsletter</strong><span>Invio aggiornamenti su tornei,calendari e novita.</span></div></label><label class="consent-option"><input type="checkbox" data-consent="marketing"><div class="consent-option-body"><strong>Comunicazioni promozionali</strong><span>Info sui tornei e comunicazioni dedicate.</span></div></label></div><div class="consent-actions"><button type="button" class="btn-ghost" data-consent="reject">Rifiuta tutto</button><button type="button" class="btn-muted" data-consent="save">Salva preferenze</button><button type="button" class="btn-primary" data-consent="accept">Accetta tutto</button></div></div>`;document.body.appendChild(banner);fillBanner(loadConsent()||{});toggleNewsletterVisibility();banner.addEventListener('click',(event)=>{const btn=event.target instanceof Element ? event.target.closest('[data-consent]'):null;if(!btn)return;const choice=btn.getAttribute('data-consent');if(choice==='accept'){handleSave({tracking:true,marketing:true,newsletter:true});return;}if(choice==='reject'){handleSave({tracking:false,marketing:false,newsletter:false});return;}if(choice==='save'){const consent=collectBannerConsent();handleSave(consent);}});}document.addEventListener('click',(event)=>{const trigger=event.target instanceof Element ? event.target.closest('[data-open-consent]'):null;if(trigger){event.preventDefault();showBanner();}});function initConsent(){renderBanner();const consent=loadConsent();if(!consent){showBanner();}applyConsent(consent);}if(document.readyState !=='loading'){initConsent();}else{document.addEventListener('DOMContentLoaded',initConsent);}})();